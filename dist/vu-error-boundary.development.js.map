{"version":3,"file":"vu-error-boundary.development.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  ComponentPublicInstance,\n  defineComponent,\n  onErrorCaptured,\n  Ref,\n  ref,\n  renderSlot,\n  unref,\n  watchEffect,\n} from 'vue'\n\nexport const ErrorBoundary = defineComponent({\n  name: 'ErrorBoundary',\n  emits: {\n    reset: () => {\n      return true\n    },\n    error: (...args: [unknown, ComponentPublicInstance | null, string]) => {\n      if (args) return true\n    },\n  },\n  setup(_, { slots, emit }) {\n    // state\n    const error = ref<unknown>(null)\n\n    // methods\n    const resetErrorBoundary = () => {\n      emit('reset')\n      error.value = null\n    }\n\n    // hooks\n    onErrorCaptured((err, instance, info) => {\n      emit('error', err, instance, info)\n      error.value = err\n\n      return false\n    })\n\n    return () => {\n      if (unref(error)) {\n        return renderSlot(slots, 'fallback', {\n          resetErrorBoundary,\n          error: unref(error),\n        })\n      }\n\n      return slots.default?.()\n    }\n  },\n})\n\nexport function useErrorHandler(\n  givenError?: Ref<unknown>\n): (args: unknown) => void {\n  const error = ref<unknown>(null)\n\n  watchEffect(() => {\n    if (unref(givenError)) throw unref(givenError)\n    if (unref(error)) throw unref(error)\n  })\n\n  return args => {\n    error.value = args\n  }\n}\n"],"names":["ErrorBoundary","defineComponent","name","emits","reset","error","args","setup","_","slots","emit","ref","resetErrorBoundary","value","onErrorCaptured","err","instance","info","unref","renderSlot","useErrorHandler","givenError","watchEffect"],"mappings":";;;;;;MAWaA,aAAa,GAAGC,mBAAe,CAAC;EAC3CC,EAAAA,IAAI,EAAE,eADqC;EAE3CC,EAAAA,KAAK,EAAE;EACLC,IAAAA,KAAK,EAAE,iBAAM;EACX,aAAO,IAAP;EACD,KAHI;EAILC,IAAAA,KAAK,EAAE,iBAAgE;EAAA,wCAA5DC,IAA4D;EAA5DA,QAAAA,IAA4D;EAAA;;EACrE,UAAIA,IAAJ,EAAU,OAAO,IAAP;EACX;EANI,GAFoC;EAU3CC,EAAAA,KAV2C,iBAUrCC,CAVqC,QAUjB;EAAA,QAAfC,KAAe,QAAfA,KAAe;EAAA,QAARC,IAAQ,QAARA,IAAQ;EACxB;EACA,QAAML,KAAK,GAAGM,OAAG,CAAU,IAAV,CAAjB,CAFwB;;EAKxB,QAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;EAC/BF,MAAAA,IAAI,CAAC,OAAD,CAAJ;EACAL,MAAAA,KAAK,CAACQ,KAAN,GAAc,IAAd;EACD,KAHD,CALwB;;;EAWxBC,IAAAA,mBAAe,CAAC,UAACC,GAAD,EAAMC,QAAN,EAAgBC,IAAhB,EAAyB;EACvCP,MAAAA,IAAI,CAAC,OAAD,EAAUK,GAAV,EAAeC,QAAf,EAAyBC,IAAzB,CAAJ;EACAZ,MAAAA,KAAK,CAACQ,KAAN,GAAcE,GAAd;EAEA,aAAO,KAAP;EACD,KALc,CAAf;EAOA,WAAO,YAAM;EACX,UAAIG,SAAK,CAACb,KAAD,CAAT,EAAkB;EAChB,eAAOc,cAAU,CAACV,KAAD,EAAQ,UAAR,EAAoB;EACnCG,UAAAA,kBAAkB,EAAlBA,kBADmC;EAEnCP,UAAAA,KAAK,EAAEa,SAAK,CAACb,KAAD;EAFuB,SAApB,CAAjB;EAID;;EAED,aAAOI,KAAK,WAAZ,oBAAOA,KAAK,WAAL,EAAP;EACD,KATD;EAUD;EAtC0C,CAAD;EAyCrC,SAASW,eAAT,CACLC,UADK,EAEoB;EACzB,MAAMhB,KAAK,GAAGM,OAAG,CAAU,IAAV,CAAjB;EAEAW,EAAAA,eAAW,CAAC,YAAM;EAChB,QAAIJ,SAAK,CAACG,UAAD,CAAT,EAAuB,MAAMH,SAAK,CAACG,UAAD,CAAX;EACvB,QAAIH,SAAK,CAACb,KAAD,CAAT,EAAkB,MAAMa,SAAK,CAACb,KAAD,CAAX;EACnB,GAHU,CAAX;EAKA,SAAO,UAAAC,IAAI,EAAI;EACbD,IAAAA,KAAK,CAACQ,KAAN,GAAcP,IAAd;EACD,GAFD;EAGD;;;;;;;;;;;"}